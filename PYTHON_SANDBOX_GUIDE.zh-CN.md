# Python 沙箱服务：用户与开发者指南

## 1. 概述

Python 沙箱服务提供了一个安全、隔离的环境，用于执行任意的 Python 代码片段。它主要被设计为供 AI 模型使用的工具，使其能够执行计算、运行算法和处理数据，而不会对主机系统带来任何安全风险。

其核心设计理念是 **“安全第一”**。服务的每个组件都旨在最小化风险，并假设所有待执行的代码都是不可信的，甚至是恶意的。每次代码执行都是完全临时的、无状态的。

## 2. 核心能力与安全设计

该服务的强大之处在于其多层安全模型，该模型严格定义了代码能做什么和不能做什么。

### 2.1 安全层级

-   **Docker 容器隔离**: 每一段代码都在其专属的、一次性的 Docker 容器中运行。该容器基于一个自定义镜像（该镜像以`python:3.11-slim`为基础），其中包含了下述的可用库。容器在执行后会被自动销毁，确保不会在两次运行之间保留任何状态。
-   **无网络访问**: 容器以 `network_disabled=True` 模式启动。这完全保证了被执行的代码无法进行任何内部或外部的网络调用。
-   **只读文件系统**: 容器的文件系统以只读模式挂载 (`read_only=True`)。代码无法在容器内写入或修改任何文件。
-   **严格的资源限制**: 为防止拒绝服务攻击或资源滥用，每个容器的资源上限被严格限制在 **512MB 内存** 和 **半个 CPU 核心**。
-   **解释器级别沙箱**: Python 的 `exec` 函数通过一个受限的内置函数“白名单”来调用。这可以防止代码访问危险的函数（如 `open`, `eval`），即使在容器内部，也提供了第二层安全保护。

### 2.2 可用库
沙箱环境中预装了一系列精心挑选的、用于数据科学和符号数学的流行库。

-   **Numpy**: Python 科学计算的基础包。用于处理高性能的多维数组对象以及操作这些数组的工具。
-   **Pandas**: 一个快速、强大且易于使用的开源数据分析和处理工具，是处理结构化数据的必备库。
-   **Openpyxl**: 一个用于在内存中读/写 Excel 2010 xlsx/xlsm/xltx/xltm 格式文件的 Python 库。
-   **Sympy**: 一个用于符号数学的 Python 库。它的目标是成为一个功能齐全的计算机代数系统（CAS），同时保持代码尽可能简单，以便于理解和扩展。

此外, Python 广泛的 **标准库** 也同样可用 (例如 `math`, `random`, `datetime`, `json`, `re`)。

## 3. 使用场景与示例

### 场景一: 使用 Numpy 进行高级计算
使用 `numpy` 进行复杂的数值运算。

**示例代码:**
```python
import numpy as np

# 创建两个矩阵
matrix_a = np.array([[1, 2], [3, 4]])
matrix_b = np.array([[5, 6], [7, 8]])

# 执行矩阵乘法
result = np.dot(matrix_a, matrix_b)

print("矩阵 A:\n", matrix_a)
print("矩阵 B:\n", matrix_b)
print("乘法结果:\n", result)
```
**预期 JSON 输出:**
```json
{
  "stdout": "矩阵 A:\n [[1 2]\n [3 4]]\n矩阵 B:\n [[5 6]\n [7 8]]\n乘法结果:\n [[19 22]\n [43 50]]\n",
  "stderr": "",
  "exit_code": 0
}
```

### 场景二: 使用 Pandas 进行数据处理
使用 `pandas` 创建并操作一个简单的数据帧（DataFrame）。

**示例代码:**
```python
import pandas as pd

# 创建一个示例数据集
data = {
    '产品': ['A', 'B', 'C', 'D'],
    '销售额': [150, 200, 180, 220]
}
df = pd.DataFrame(data)

# 计算总销售额
total_sales = df['销售额'].sum()

print("销售数据:\n", df)
print("\n总销售额:", total_sales)
```
**预期 JSON 输出:**
```json
{
  "stdout": "销售数据:\n   产品  销售额\n0   A    150\n1   B    200\n2   C    180\n3   D    220\n\n总销售额: 750\n",
  "stderr": "",
  "exit_code": 0
}
```

## 4. 局限性

了解此服务 **不能** 做什么至关重要：
-   **无网络访问**: 无法调用 API、下载文件或访问任何网络资源。
-   **无文件 I/O**: 无法读取或写入任何文件。`openpyxl` 库只能操作内存中的数据，不能从磁盘读写。
-   **无绘图功能**: 未安装 `matplotlib` 和 `seaborn` 等可视化库，以保持服务轻量，并专注于数据处理和计算。
-   **无状态**: 每次执行都是独立的。一次运行中的变量或状态无法在下一次运行中使用。
-   **内存限制**: 尽管内存上限为 512MB，但处理超大数据集仍有可能耗尽内存。因此，我们特意排除了 `scikit-learn` 和 `scipy` 等内存密集型库。